import"./style-CwViLTPP.js";class u{constructor(){this.apiBaseUrl="https://openlibrary.org",this.currentPage=1,this.booksPerPage=12,this.currentSearchQuery="",this.initializeEventListeners(),this.loadInitialBooks()}initializeEventListeners(){document.getElementById("searchInput").addEventListener("keypress",s=>{s.key==="Enter"&&this.performSearch()}),document.getElementById("loadMoreBtn").addEventListener("click",()=>{this.loadMoreBooks()})}async loadInitialBooks(){this.showLoading(),this.currentPage=1,this.currentSearchQuery="";try{const t=await this.getTrendingBooks();this.displayBooks(t,"Popular books")}catch{this.showNotFound()}}async performSearch(){const e=document.getElementById("searchInput").value.trim();if(e){this.currentSearchQuery=e,this.currentPage=1,this.showLoading();try{const s=await this.searchBooks(e,1);this.displayBooks(s,`Search results: "${e}"`)}catch{this.showNotFound()}}}async loadMoreBooks(){this.currentPage++;const t=document.getElementById("loading");t.style.display="flex";try{let e;this.currentSearchQuery?e=await this.searchBooks(this.currentSearchQuery,this.currentPage):e=await this.getTrendingBooks(this.currentPage),!e||e.length===0?this.showNotFound():this.appendBooks(e)}catch{this.showNotFound()}finally{t.style.display="none"}}async searchBooks(t,e=1){const s=(e-1)*this.booksPerPage,o=`${this.apiBaseUrl}/search.json?q=${encodeURIComponent(t)}&limit=${this.booksPerPage}&offset=${s}&fields=key,title,author_name,first_publish_year,subject,cover_i,isbn,number_of_pages_median,ratings_average,description`;try{const r=await fetch(o);if(!r.ok)return[];const n=await r.json();return Array.isArray(n.docs)?n.docs:[]}catch{return[]}}async getTrendingBooks(t=1){const e=["bestseller","popular","classic","award"],s=e[Math.floor(Math.random()*e.length)];return await this.searchBooks(s,t)}async getRandomBooks(){const t=String.fromCharCode(97+Math.floor(Math.random()*26));return await this.searchBooks(t,1)}async getBookDetails(t){const e=`${this.apiBaseUrl}${t}.json`;try{const s=await fetch(e);if(!s.ok)return{};const o=await s.json();return o.covers&&o.covers.length>0&&(o.cover_i=o.covers[0]),o}catch{return{}}}showLoading(){const t=document.getElementById("loading"),e=document.getElementById("booksGallery");t.style.display="flex",e.style.display="none"}displayBooks(t,e){const s=document.getElementById("loading"),o=document.getElementById("booksGallery"),r=document.getElementById("categoryTitle"),n=document.getElementById("booksGrid");if(r.textContent=e,n.innerHTML="",!t||t.length===0){this.showNotFound();return}t.forEach(a=>{this.addBookCard(a,n)}),s.style.display="none",o.style.display="block",o.style.opacity="0",o.style.transform="translateY(20px)",setTimeout(()=>{o.style.transition="all 0.5s ease",o.style.opacity="1",o.style.transform="translateY(0)"},100)}appendBooks(t){const e=document.getElementById("booksGrid");if(!t||t.length===0){this.showNotFound();return}t.forEach(s=>{this.addBookCard(s,e)})}addBookCard(t,e){const s=document.createElement("div");s.className="book-card";const o=t.title||"Unknown book",r=t.author_name?t.author_name[0]:t.authors&&t.authors[0]?t.authors[0].name:"Unknown author",n=t.first_publish_year||t.publish_date||"",a=Array.isArray(t.subject)?t.subject.slice(0,3):[],c=t.description?typeof t.description=="string"?t.description:t.description.value||"":"",d=t.ratings_average||0,l=t.number_of_pages_median||"";let i="";t.cover_i?i=`https://covers.openlibrary.org/b/id/${t.cover_i}-L.jpg`:t.isbn&&t.isbn[0]&&(i=`https://covers.openlibrary.org/b/isbn/${t.isbn[0]}-L.jpg`),s.innerHTML=`
            <img src="${i}" alt="${o}" class="book-cover" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDIwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0yMCAyMEgxODBWMjgwSDIwVjIwWiIgZmlsbD0iI0NDQ0NDQyIvPgo8cGF0aCBkPSJNMzAgNDBIMTcwVjI3MEgzMFY0MFoiIGZpbGw9IndoaXRlIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTUwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOTk5OTk5IiBmb250LXNpemU9IjE0Ij5ObyBDb3ZlcjwvdGV4dD4KPC9zdmc+'">
            <div class="book-info">
                <div class="book-title">${this.truncateText(o,60)}</div>
                <div class="book-author">${this.truncateText(r,40)}</div>
                ${n?`<div class="book-year">${n}${l?` • ${l} стр.`:""}</div>`:""}
                ${a.length>0?`
                    <div class="book-subjects">
                        ${a.map(h=>`<span class="subject-tag">${this.truncateText(h,15)}</span>`).join("")}
                    </div>
                `:""}
                ${c?`<div class="book-description">${this.truncateText(c,120)}</div>`:""}
                ${d>0?`
                    <div class="book-rating">
                        ${d.toFixed(1)}/5
                    </div>
                `:""}
            </div>
        `,e.appendChild(s)}truncateText(t,e){return t?t.length<=e?t:t.substring(0,e)+"...":""}showNotFound(){const t=document.getElementById("loading"),e=document.getElementById("booksGallery"),s=document.getElementById("booksGrid");t.style.display="none",e.style.display="block",s.innerHTML=`
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #121212;">
                <h3>Books not found</h3>
            </div>
        `}showError(t){this.showNotFound()}}document.addEventListener("DOMContentLoaded",()=>{new u});
