import"./style-CwViLTPP.js";class y{constructor(){this.apiBaseUrl="https://openlibrary.org",this.currentPage=1,this.booksPerPage=12,this.currentSearchQuery="",this.initializeEventListeners(),this.loadInitialBooks()}initializeEventListeners(){document.getElementById("searchInput").addEventListener("keypress",o=>{o.key==="Enter"&&this.performSearch()}),document.getElementById("loadMoreBtn").addEventListener("click",()=>{this.loadMoreBooks()})}async loadInitialBooks(){this.showLoading(),this.currentPage=1,this.currentSearchQuery="";try{const e=await this.getTrendingBooks();this.displayBooks(e,"Popular books")}catch(e){console.error("Error loading initial books:",e),this.showError("Book loading error. Please try again.")}}async performSearch(){const t=document.getElementById("searchInput").value.trim();if(!t){alert("Please enter a search query.");return}this.currentSearchQuery=t,this.currentPage=1,this.showLoading();try{const o=await this.searchBooks(t,1);this.displayBooks(o,`Search results:: "${t}"`)}catch(o){console.error("Error searching books:",o),this.showError("Search error. Try again.")}}async loadMoreBooks(){this.currentPage++;const e=document.getElementById("loading");e.style.display="flex";try{let t;this.currentSearchQuery?t=await this.searchBooks(this.currentSearchQuery,this.currentPage):t=await this.getTrendingBooks(this.currentPage),this.appendBooks(t)}catch(t){console.error("Error loading more books:",t),this.showError("Error loading additional books.")}finally{e.style.display="none"}}async searchBooks(e,t=1){const o=(t-1)*this.booksPerPage,s=`${this.apiBaseUrl}/search.json?q=${encodeURIComponent(e)}&limit=${this.booksPerPage}&offset=${o}&fields=key,title,author_name,first_publish_year,subject,cover_i,isbn,number_of_pages_median,ratings_average,description`,n=await fetch(s);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const r=await n.json();if(r.docs&&r.docs.length>0)return r.docs;throw new Error("No books found")}async getTrendingBooks(e=1){const t=["bestseller","popular","classic","award"],o=t[Math.floor(Math.random()*t.length)];return await this.searchBooks(o,e)}async getRandomBooks(){const e=String.fromCharCode(97+Math.floor(Math.random()*26));return await this.searchBooks(e,1)}async getBookDetails(e){const t=`${this.apiBaseUrl}${e}.json`,o=await fetch(t);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const s=await o.json();return s.covers&&s.covers.length>0&&(s.cover_i=s.covers[0]),s}showLoading(){const e=document.getElementById("loading"),t=document.getElementById("booksGallery");e.style.display="flex",t.style.display="none"}displayBooks(e,t){const o=document.getElementById("loading"),s=document.getElementById("booksGallery"),n=document.getElementById("categoryTitle"),r=document.getElementById("booksGrid");n.textContent=t,r.innerHTML="",e.forEach(a=>{this.addBookCard(a,r)}),o.style.display="none",s.style.display="block",s.style.opacity="0",s.style.transform="translateY(20px)",setTimeout(()=>{s.style.transition="all 0.5s ease",s.style.opacity="1",s.style.transform="translateY(0)"},100)}appendBooks(e){const t=document.getElementById("booksGrid");e.forEach(o=>{this.addBookCard(o,t)})}addBookCard(e,t){const o=document.createElement("div");o.className="book-card";const s=e.title||"Unknown book",n=e.author_name?e.author_name[0]:e.authors?e.authors[0].name:"Unknown author",r=e.first_publish_year||e.publish_date||"",a=e.subject?e.subject.slice(0,3):[],c=e.description?typeof e.description=="string"?e.description:e.description.value||"":"",l=e.ratings_average||0,d=e.number_of_pages_median||"";let i="";e.cover_i?i=`https://covers.openlibrary.org/b/id/${e.cover_i}-L.jpg`:e.isbn&&e.isbn[0]&&(i=`https://covers.openlibrary.org/b/isbn/${e.isbn[0]}-L.jpg`),o.innerHTML=`
            <img src="${i}" alt="${s}" class="book-cover" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDIwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0yMCAyMEgxODBWMjgwSDIwVjIwWiIgZmlsbD0iI0NDQ0NDQyIvPgo8cGF0aCBkPSJNMzAgNDBIMTcwVjI3MEgzMFY0MFoiIGZpbGw9IndoaXRlIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTUwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOTk5OTk5IiBmb250LXNpemU9IjE0Ij5ObyBDb3ZlcjwvdGV4dD4KPC9zdmc+'">
            <div class="book-info">
                <div class="book-title">${this.truncateText(s,60)}</div>
                <div class="book-author">${this.truncateText(n,40)}</div>
                ${r?`<div class="book-year">${r}${d?` • ${d} стр.`:""}</div>`:""}
                ${a.length>0?`
                    <div class="book-subjects">
                        ${a.map(h=>`<span class="subject-tag">${this.truncateText(h,15)}</span>`).join("")}
                    </div>
                `:""}
                ${c?`<div class="book-description">${this.truncateText(c,120)}</div>`:""}
                ${l>0?`
                    <div class="book-rating">
                        ${l.toFixed(1)}/5
                    </div>
                `:""}
            </div>
        `,t.appendChild(o)}truncateText(e,t){return e.length<=t?e:e.substring(0,t)+"..."}showError(e){const t=document.getElementById("loading"),o=document.getElementById("booksGallery"),s=document.getElementById("booksGrid");t.style.display="none",o.style.display="block",s.innerHTML=`
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #FF6B6B;">
                <h3>${e}</h3>
                <p>Try selecting a different category or searching in a different way</p>
            </div>
        `}}document.addEventListener("DOMContentLoaded",()=>{new y});
